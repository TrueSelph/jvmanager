import{w as h,C as p,y,a as b}from"./chunk-QMGIS6GS-CBZUm-7V.js";import{j as r}from"./jsx-runtime-D_zvdyIk.js";import{B as I}from"./polymorphic-factory-aZn9nhyV.js";import{G as x}from"./Group-BgvTqR_9.js";import{T as w}from"./Title-DsPuOqIQ.js";import{B as j}from"./Button-BH1hN9oM.js";import{c as v}from"./createReactComponent-CwEnMXT7.js";import{D as S}from"./Divider-C0Sq59zE.js";import{C as k}from"./Card-Bkt36yw-.js";import"./Loader-BKuNbySO.js";import"./index-B4z8r-Ct.js";import"./Paper-CnFb9jmT.js";import"./create-safe-context-CzEsa9t0.js";/**
 * @license @tabler/icons-react v3.34.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var f=v("outline","eraser","IconEraser",[["path",{d:"M19 20h-10.5l-4.21 -4.3a1 1 0 0 1 0 -1.41l10 -10a1 1 0 0 1 1.41 0l5 5a1 1 0 0 1 0 1.41l-9.2 9.3",key:"svg-0"}],["path",{d:"M18 13.3l-6.3 -6.3",key:"svg-1"}]]);const o=[];for(let t=0;t<256;++t)o.push((t+256).toString(16).slice(1));function C(t,e=0){return(o[t[e+0]]+o[t[e+1]]+o[t[e+2]]+o[t[e+3]]+"-"+o[t[e+4]]+o[t[e+5]]+"-"+o[t[e+6]]+o[t[e+7]]+"-"+o[t[e+8]]+o[t[e+9]]+"-"+o[t[e+10]]+o[t[e+11]]+o[t[e+12]]+o[t[e+13]]+o[t[e+14]]+o[t[e+15]]).toLowerCase()}let d;const D=new Uint8Array(16);function _(){if(!d){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");d=crypto.getRandomValues.bind(crypto)}return d(D)}const E=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),l={randomUUID:E};function U(t,e,a){var n;if(l.randomUUID&&!t)return l.randomUUID();t=t||{};const s=t.random??((n=t.rng)==null?void 0:n.call(t))??_();if(s.length<16)throw new Error("Random bytes length must be >= 16");return s[6]=s[6]&15|64,s[8]=s[8]&63|128,C(s)}async function G(){var t;try{const e=localStorage.getItem("jivas-token")||"",a=localStorage.getItem("jivas-host")||"",s=localStorage.getItem("jivas-agent")||"",n=(t=document.cookie.match(/tsSessionId=([^;]+)/))==null?void 0:t[1],i=n&&n!=="undefined"?n:U();try{await fetch(`${a}/walker/add_frame`,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({agent_id:s,session_id:i})}).catch(c=>{console.error("Error creating session:",c)})}catch{console.log("unable to create session")}return{sessionId:i,host:localStorage.getItem("jivas-host")||"",agentId:localStorage.getItem("jivas-agent")||""}}catch(e){return console.log(e),{sessionId:"jvmanager",host:localStorage.getItem("jivas-host")||"",agentId:localStorage.getItem("jivas-agent")||""}}}async function L({context:t,request:e}){const a=await e.formData(),s=a.get("_action"),n=new FormData,i=a.get("agentId")||"",c=localStorage.getItem("jivas-token")||"",m=localStorage.getItem("jivas-host")||"",g=a.get("sessionId");if(s==="wipeAgentMemory")return n.append("args",JSON.stringify({session_id:g})),n.append("module_root","actions.jivas.agent_utils_action"),n.append("agent_id",i),n.append("walker","purge_frame_memory"),await fetch(`${m}/action/walker`,{method:"POST",headers:{Authorization:`Bearer ${c}`},body:n}).then(async u=>await u.json())}function q(){return[{title:"Chat | JIVAS Manager"}]}const H=h(function({loaderData:e}){const{selectedAgentInfo:a}=p(),s=y(),n=b.useCallback(()=>{const i=new CustomEvent("tsmclearmessages");s.submit({_action:"wipeAgentMemory",agentId:e.agentId||"",sessionId:e.sessionId||""},{method:"POST"}),window.dispatchEvent(i)},[]);return r.jsxs(I,{py:"xl",px:"xl",children:[r.jsxs(x,{justify:"space-between",children:[r.jsx(w,{order:3,children:"Chat"}),r.jsx(j,{color:"dark",leftSection:r.jsx(f,{className:"h-5 w-5"}),size:"xs",onClick:n,loading:s.state!=="idle",children:"Clear Chat Memory"})]}),r.jsx(S,{mt:"xs",mb:"xl"}),r.jsx(k,{px:"xl",h:"80vh",withBorder:!0,children:r.jsx("ts-messenger",{host:e.host,"agent-id":e.agentId,"agent-name":a==null?void 0:a.name,theme:JSON.stringify({"--ts-chat-bg":"white","--ts-chat-fg":"black","--ts-chat-popup-bg":"white","--ts-icon-btn-bg":"transparent","--ts-icon-btn-hover-bg":"#E4E4E7","--ts-input-btn-color":"black","--ts-input-bg":"#dbdbdb42","--ts-input-bd":"#D4D4D8","--ts-chat-bd":"#D4D4D8","--chakra-colors-border":"#D4D4D8","--ts-input-color":"black","--ts-input-placeholder-color":"#000000eb","--ts-response-msg-color":"black"}),"with-debug":"true",layout:"standard","session-id":e.sessionId||"","use-local-storage-cache":"true",style:{height:"100%"}})})]})});export{L as clientAction,G as clientLoader,H as default,q as meta};
