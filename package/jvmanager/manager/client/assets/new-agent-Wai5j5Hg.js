import{w as C,v as b,a as v,G as z,y as T,q as K,A as M}from"./chunk-QMGIS6GS-CBZUm-7V.js";import{j as e}from"./jsx-runtime-D_zvdyIk.js";import{C as I}from"./Card-BHrMkZ_V.js";import{G as g}from"./Group-bnACpcuK.js";import{B as k}from"./Badge-CHFht4LR.js";import{c as f}from"./createReactComponent-CwEnMXT7.js";import{T as S}from"./Text-CkpJSrnl.js";import{T as t,d as _}from"./dayjs.min-CzDNk_5I.js";import{d as B}from"./ScrollArea-C8H_Wh73.js";import{B as j}from"./polymorphic-factory-EW0USS3V.js";import{T as x}from"./Title-B0fFn55O.js";import{D}from"./Divider-BI4N1hoX.js";import{P as N}from"./Paper-k397c_lM.js";import{B as u}from"./Button-BhC08Y9X.js";import{I as R}from"./IconArrowLeft-4qKQ7vAI.js";import{S as w}from"./SimpleGrid-DIRoZGR6.js";import{I as J}from"./Input-I-MjqIR2.js";import{L}from"./Loader-1VreoqJz.js";import{m as A}from"./events-BOd7YSSb.js";import{S as F}from"./Stack-BsPYYAFq.js";import{P as G}from"./PasswordInput-DJfOJho_.js";import"./create-safe-context-CzEsa9t0.js";import"./index-B4z8r-Ct.js";import"./CloseButton-BDZlzHA2.js";import"./use-merged-ref-DUVM9oA6.js";import"./px-CiO0pVtX.js";import"./get-sorted-breakpoints-CWbmZd_q.js";import"./ActionIcon-BO4DDcDR.js";import"./use-input-props-CaHG8Gfi.js";/**
 * @license @tabler/icons-react v3.34.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var V=f("outline","download","IconDownload",[["path",{d:"M4 17v2a2 2 0 0 0 2 2h12a2 2 0 0 0 2 -2v-2",key:"svg-0"}],["path",{d:"M7 11l5 5l5 -5",key:"svg-1"}],["path",{d:"M12 4l0 12",key:"svg-2"}]]);/**
 * @license @tabler/icons-react v3.34.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var E=f("outline","plus","IconPlus",[["path",{d:"M12 5l0 14",key:"svg-0"}],["path",{d:"M5 12l14 0",key:"svg-1"}]]);/**
 * @license @tabler/icons-react v3.34.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var O=f("outline","search","IconSearch",[["path",{d:"M10 10m-7 0a7 7 0 1 0 14 0a7 7 0 1 0 -14 0",key:"svg-0"}],["path",{d:"M21 21l-6 -6",key:"svg-1"}]]);/**
 * @license @tabler/icons-react v3.34.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Y=f("outline","settings","IconSettings",[["path",{d:"M10.325 4.317c.426 -1.756 2.924 -1.756 3.35 0a1.724 1.724 0 0 0 2.573 1.066c1.543 -.94 3.31 .826 2.37 2.37a1.724 1.724 0 0 0 1.065 2.572c1.756 .426 1.756 2.924 0 3.35a1.724 1.724 0 0 0 -1.066 2.573c.94 1.543 -.826 3.31 -2.37 2.37a1.724 1.724 0 0 0 -2.572 1.065c-.426 1.756 -2.924 1.756 -3.35 0a1.724 1.724 0 0 0 -2.573 -1.066c-1.543 .94 -3.31 -.826 -2.37 -2.37a1.724 1.724 0 0 0 -1.065 -2.572c-1.756 -.426 -1.756 -2.924 0 -3.35a1.724 1.724 0 0 0 1.066 -2.573c-.94 -1.543 .826 -3.31 2.37 -2.37c1 .608 2.296 .07 2.572 -1.065z",key:"svg-0"}],["path",{d:"M9 12a3 3 0 1 0 6 0a3 3 0 0 0 -6 0",key:"svg-1"}]]);const q="https://api-jpr.trueselph.com",U="_root_18rw4_1",$={root:U};function H({pkg:r,onClick:a}){return e.jsxs(I,{withBorder:!0,padding:"lg",radius:"md",onClick:a?()=>a(r):void 0,className:$.root,children:[e.jsxs(g,{justify:"space-between",children:[e.jsx(k,{size:"sm",color:"gray",variant:"outline",children:r.version||"-"}),e.jsx(k,{size:"sm",leftSection:e.jsx(V,{size:14}),variant:"filled",color:"dark",children:r.downloads})]}),e.jsx(S,{fz:"md",fw:500,mt:"md",children:r.title}),e.jsx(S,{fz:"sm",c:"gray.7",mt:5,lineClamp:3,children:r.description})]})}function Ie(){return[{title:"New Agent | JIVAS Manager"}]}async function Ae({request:r}){const a=new URL(r.url),s=a.searchParams.get("limit")||"10",i=a.searchParams.get("offset")||"0",n=a.searchParams.get("search")||"",l=a.searchParams.get("type")||"agent",c=localStorage.getItem("jpr-key")||null,o=new URL(`${q}/packages/search`);o.searchParams.set("limit",s),o.searchParams.set("offset",i),o.searchParams.set("q",n),console.log({packageType:l,search:n}),o.searchParams.set("type",l==="all"?"":l);const d=c?{"x-api-key":c}:void 0;console.log({headers:d});const m=await fetch(o.toString(),{method:"GET",headers:{...d,"Content-Type":"application/json"}}).then(h=>h.json());return{packages:m.packages,totalPackages:m.total,apiKey:c||""}}async function Ce({request:r}){var c;const a=localStorage.getItem("jivas-host"),s=localStorage.getItem("jivas-token"),i=localStorage.getItem("jpr-key"),n=await r.formData(),l=n.get("_action");if(l==="createAgentFromDaf"){const o=n.get("version"),d=n.get("package"),m=await fetch(`${a}/walker/import_agent`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify({reporting:!0,daf_name:d,daf_version:o||"latest",jpr_api_key:i||void 0})}).then(async y=>await y.json()),h=(c=m.reports)==null?void 0:c[0];return h?(localStorage.setItem("jivas-agent",h.id),b("/dashboard")):m.reports}if(l==="updateJPRApiKey"){const o=n.get("apiKey");return localStorage.setItem("jpr-key",o||""),{}}}const be=C(function({loaderData:a}){var P;localStorage.getItem("jivas-host"),localStorage.getItem("jivas-token");const[s,i]=v.useState(null),[n,l]=v.useState(new Set([])),[c,o]=z(),d=T(),m=B(async p=>{c.set("search",p),o(c)},500),h=K(),y=M();return e.jsxs(j,{py:"xl",px:"xl",children:[e.jsx(g,{justify:"space-between",children:e.jsx(x,{order:3,children:"New Agent"})}),e.jsx(D,{mt:"xs",mb:"xl"}),e.jsx(I,{h:"80vh",px:"xs",withBorder:!0,children:e.jsxs(N,{p:"md",radius:"md",h:"100%",children:[e.jsx(x,{order:3,children:"Browse Agents"}),s?e.jsxs(j,{mt:"xl",children:[e.jsxs(g,{children:[e.jsx(u,{onClick:()=>i(null),size:"xs",leftSection:e.jsx(R,{size:16}),color:"dark",children:"Back"}),e.jsx(x,{order:4,children:s.title})]}),e.jsxs(w,{mt:"lg",cols:{base:1,md:2},children:[e.jsxs(j,{children:[e.jsx(x,{order:6,children:"Description"}),e.jsx(S,{size:"sm",c:"gray.7",children:s.description})]}),e.jsxs(j,{children:[e.jsx(t,{variant:"vertical",layout:"fixed",withTableBorder:!0,children:e.jsxs(t.Tbody,{children:[e.jsxs(t.Tr,{children:[e.jsx(t.Th,{w:160,children:"Package"}),e.jsx(t.Td,{children:s.package})]}),e.jsxs(t.Tr,{children:[e.jsx(t.Th,{children:"Version"}),e.jsx(t.Td,{children:s.version})]}),e.jsxs(t.Tr,{children:[e.jsx(t.Th,{children:"Category"}),e.jsx(t.Td,{children:e.jsx(k,{color:"dark",children:s.type})})]}),e.jsxs(t.Tr,{children:[e.jsx(t.Th,{children:"Downloads"}),e.jsx(t.Td,{children:s.downloads})]}),e.jsxs(t.Tr,{children:[e.jsx(t.Th,{children:"Last Published"}),e.jsx(t.Td,{children:_(s.publishedAt).format("MMMM D, YYYY h:mm:ss A")})]})]})}),e.jsx(g,{justify:"end",mt:"lg",children:e.jsx(u,{onClick:()=>d.submit({_action:"createAgentFromDaf",package:s.package,version:s.version},{method:"POST"}),leftSection:e.jsx(E,{size:16}),loading:d.state!=="idle",color:"dark",children:"Create Agent"})})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs(g,{my:"lg",children:[e.jsx(J,{placeholder:"Search Agent",w:400,rightSection:h.state==="loading"&&h.location.pathname==y.pathname?e.jsx(L,{size:"xs"}):null,onChange:p=>{m(p.target.value)},leftSection:e.jsx(O,{size:16})}),e.jsx(u,{size:"sm",color:"dark",onClick:()=>A.open({title:"JPR Configuration",children:e.jsx(Q,{apiKeyInit:a.apiKey})}),leftSection:e.jsx(Y,{size:16}),children:"Configure"})]}),e.jsx(w,{cols:{base:1,md:2,lg:4},children:(P=a.packages)==null?void 0:P.map(p=>e.jsx(H,{onClick:i,pkg:p},p.id))})]})]})})]})});function Q({apiKeyInit:r}){const[a,s]=v.useState(r),i=T();return e.jsxs(F,{children:[e.jsx(G,{label:"API Key",placeholder:"API Key",value:a||"",onChange:n=>s(n.target.value)}),e.jsx(u,{size:"sm",color:"dark",mt:"sm",loading:i.state!=="idle",onClick:()=>{i.submit({apiKey:a,_action:"updateJPRApiKey"},{method:"POST",action:"/new-agent"}),A.closeAll()},children:"Save"})]})}export{Ce as clientAction,Ae as clientLoader,be as default,Ie as meta};
